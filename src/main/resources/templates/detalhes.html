<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Detalhes do Cliente | Âmbar CRM</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2933/2933116.png" type="image/png">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f4f6f9; }
        .card-detalhes { border: none; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); background-color: white; overflow: hidden; }
        .header-perfil { background: linear-gradient(135deg, #1e293b, #334155); color: white; padding: 30px; display: flex; align-items: center; justify-content: space-between; }
        .label-campo { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: #64748b; font-weight: 600; margin-bottom: 5px; }
        .valor-campo { font-size: 1.1rem; color: #1e293b; font-weight: 500; margin-bottom: 20px; border-bottom: 1px solid #f1f5f9; padding-bottom: 10px; }
        .valor-destaque { color: #0d6efd; font-weight: 600; }
    </style>
</head>
<body>

    <div th:replace="~{fragments/nav :: navbar}"></div>

    <div class="container" style="max-width: 900px; margin-top: 110px; margin-bottom: 50px;">
        <div class="card card-detalhes">
            <div class="header-perfil">
                <div class="d-flex align-items-center">
                    <div class="bg-white text-dark rounded-circle d-flex align-items-center justify-content-center me-3 fs-2 fw-bold" style="width: 60px; height: 60px;"><span th:text="${#strings.substring(cliente.nome, 0, 1)}">A</span></div>
                    <div><h3 class="mb-0 fw-bold" th:text="${cliente.nome}">Nome</h3><small style="opacity: 0.8;">Cadastrado em: <span th:text="${#temporals.format(cliente.dataCadastro, 'dd/MM/yyyy')}"></span></small></div>
                </div>
                <span class="badge bg-light text-dark shadow-sm px-4 py-2 fs-6"><i class="bi bi-tag-fill me-2 text-primary"></i><span th:text="${cliente.status.descricao}">Status</span></span>
            </div>

            <div class="card-body p-5">
                <h6 class="text-primary fw-bold mb-4"><i class="bi bi-person-lines-fill me-2"></i>Informações de Contato</h6>
                <div class="row">
                    <div class="col-md-4"><div class="label-campo">WhatsApp</div><div class="valor-campo"><i class="bi bi-whatsapp text-success me-1"></i> <span th:text="${cliente.telefone}"></span><a th:href="'https://wa.me/55' + ${cliente.telefoneLimpo}" target="_blank" class="btn btn-sm btn-outline-success ms-2 rounded-pill" style="font-size: 0.7em;">Abrir</a></div></div>
                    <div class="col-md-4"><div class="label-campo">E-mail</div><div class="valor-campo" th:text="${cliente.email}"></div></div>
                    <div class="col-md-4"><div class="label-campo">CPF</div><div class="valor-campo" th:text="${cliente.cpf ?: '-'}"></div></div>
                </div>

                <h6 class="text-primary fw-bold mb-4 mt-4"><i class="bi bi-house-heart-fill me-2"></i>Interesse e Origem</h6>
                <div class="row">
                    <div class="col-md-6"><div class="label-campo">Imóvel</div><div class="valor-campo valor-destaque" th:text="${cliente.nomeImovel ?: 'Não informado'}"></div></div>
                    <div class="col-md-3"><div class="label-campo">Fonte</div><div class="valor-campo" th:text="${cliente.fonteCaptacao}"></div></div>
                    <div class="col-md-3"><div class="label-campo">Detalhe</div><div class="valor-campo" th:text="${cliente.tipoAprovacao ?: '-'}"></div></div>
                </div>

                <div th:if="${cliente.dataAgendamento != null}" class="alert alert-warning border-warning mt-3">
                    <h6 class="text-warning fw-bold mb-3"><i class="bi bi-calendar-event me-2"></i>Agendamento</h6>
                    <div class="row">
                        <div class="col-md-4"><strong>Data:</strong> <span th:text="${#temporals.format(cliente.dataAgendamento, 'dd/MM/yyyy')}"></span></div>
                        <div class="col-md-3"><strong>Hora:</strong> <span th:text="${cliente.horaAgendamento}"></span></div>
                        <div class="col-md-5"><strong>Local:</strong> <span th:text="${cliente.localAgendamento}"></span></div>
                    </div>
                </div>
                <div class="mt-4 p-3 bg-light rounded border"><div class="label-campo mb-2"><i class="bi bi-chat-quote-fill me-1"></i> Observações</div><p class="mb-0 text-muted fst-italic" th:text="${cliente.observacao ?: 'Nenhuma observação registrada.'}"></p></div>
            </div>

            <div class="card-footer bg-light p-4 d-flex justify-content-between align-items-center">
                <div>
                    <a th:href="@{/excluir/{id}(id=${cliente.id})}" class="btn btn-outline-danger btn-sm border-0 fw-bold" 
                       onclick="confirmarExclusao(event, this.href)">
                        <i class="bi bi-trash-fill me-1"></i> Excluir Cliente
                    </a>
                </div>
                <div class="d-flex gap-2">
                    <a href="/" class="btn btn-outline-secondary px-4 fw-bold">Voltar</a>
                    <a th:href="@{/editar/{id}(id=${cliente.id})}" class="btn btn-primary px-4 fw-bold shadow-sm"><i class="bi bi-pencil-square me-2"></i> Editar</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function confirmarExclusao(event, url) {
            event.preventDefault(); // Impede o link de abrir na hora
            
            Swal.fire({
                title: 'Tem certeza?',
                text: "Você não poderá reverter esta ação!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Sim, excluir!',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = url; // Se confirmar, vai para o link
                }
            })
        }
    </script>
</body>
</html>