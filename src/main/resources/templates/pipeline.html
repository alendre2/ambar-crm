<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Funil de Vendas | √Çmbar CRM</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f6f9;
            overflow-y: hidden; 
            height: 100vh;
        }
        
        .kanban-container {
            margin-top: 80px; 
            height: calc(100vh - 90px);
            padding: 20px 40px;
            overflow-x: auto; 
            display: flex;
            gap: 25px;
        }

        .kanban-col {
            min-width: 300px; max-width: 300px;
            background-color: #ebecf0; 
            border-radius: 12px; padding: 15px;
            display: flex; flex-direction: column;
            height: 100%;
        }

        .col-header {
            font-weight: 600; color: #172b4d;
            margin-bottom: 15px; display: flex;
            align-items: center; justify-content: space-between;
            padding: 0 5px;
        }

        .col-body {
            overflow-y: auto; flex-grow: 1; padding-right: 5px;
        }
        
        .col-body::-webkit-scrollbar { width: 6px; }
        .col-body::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 10px; }

        .card-cliente {
            background: white; border-radius: 8px;
            padding: 12px 15px; margin-bottom: 10px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            border-left: 4px solid transparent;
            transition: all 0.2s;
        }

        .card-cliente:hover {
            transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* Link do Nome no Card */
        a.card-link {
            text-decoration: none; color: #333; transition: color 0.2s;
        }
        a.card-link:hover { color: #0d6efd; text-decoration: underline; }

        .border-blue { border-left-color: #0d6efd; }
        .border-yellow { border-left-color: #ffc107; }
        .border-purple { border-left-color: #6f42c1; }
        .border-green { border-left-color: #198754; }

        .badge-status {
            font-size: 0.7em; padding: 2px 8px; border-radius: 4px;
            background-color: #f4f5f7; color: #5e6c84;
            font-weight: 600; text-transform: uppercase;
        }
    </style>
</head>
<body>

    <div th:replace="~{fragments/nav :: navbar}"></div>

    <div class="kanban-container">
        
        <div class="kanban-col">
            <div class="col-header">
                <span>INPUT / TRIAGEM</span>
                <span class="badge bg-secondary rounded-pill">Input</span>
            </div>
            <div class="col-body">
                <div th:each="c : ${listaClientes}" 
                     th:if="${c.status.name() == 'NOVO_LEAD' || c.status.name() == 'EM_CONVERSA' || c.status.name() == 'REATIVACAO'}"
                     class="card-cliente border-blue">
                    
                    <div class="d-flex justify-content-between mb-1">
                        <a th:href="@{/detalhes/{id}(id=${c.id})}" class="fw-bold card-link" th:text="${c.nome}">Nome</a>
                        <a th:href="@{/editar/{id}(id=${c.id})}" class="text-muted"><i class="bi bi-pencil-fill small"></i></a>
                    </div>
                    
                    <span class="badge-status" th:text="${c.status.descricao}">Status</span>
                    
                    <div class="mt-2 d-flex justify-content-between align-items-center">
                        <small class="text-muted" style="font-size: 0.75em;" th:text="${#temporals.format(c.dataCadastro, 'dd/MM')}">Data</small>
                        <a th:href="'https://wa.me/55' + ${c.telefoneLimpo}" target="_blank" class="text-success fw-bold text-decoration-none small">
                            <i class="bi bi-whatsapp"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="kanban-col">
            <div class="col-header">
                <span>AGENDAMENTOS</span>
                <i class="bi bi-calendar-check text-warning"></i>
            </div>
            <div class="col-body">
                <div th:each="c : ${listaClientes}" 
                     th:if="${c.status.name() == 'AGENDAMENTO' || c.status.name() == 'VISITA_IMOVEL' || c.status.name() == 'VISITA_ESCRITORIO'}"
                     class="card-cliente border-yellow">
                    
                    <div class="d-flex justify-content-between mb-1">
                        <a th:href="@{/detalhes/{id}(id=${c.id})}" class="fw-bold card-link" th:text="${c.nome}">Nome</a>
                        <a th:href="@{/editar/{id}(id=${c.id})}" class="text-muted"><i class="bi bi-pencil-fill small"></i></a>
                    </div>
                    
                    <div th:if="${c.dataAgendamento != null}" class="mb-2 bg-warning bg-opacity-10 p-1 rounded">
                        <small class="d-block text-dark fw-bold" style="font-size: 0.75em;">
                            üìÖ <span th:text="${#temporals.format(c.dataAgendamento, 'dd/MM')}"></span> - 
                            <span th:text="${c.horaAgendamento}"></span>
                        </small>
                        <small class="d-block text-muted text-truncate" style="font-size: 0.7em;" th:text="${c.localAgendamento}">Local</small>
                    </div>

                    <div class="text-end">
                        <a th:href="'https://wa.me/55' + ${c.telefoneLimpo}" target="_blank" class="text-success small fw-bold text-decoration-none">
                            <i class="bi bi-whatsapp"></i> Zap
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="kanban-col">
            <div class="col-header">
                <span>NEGOCIA√á√ÉO</span>
                <i class="bi bi-file-text text-info"></i>
            </div>
            <div class="col-body">
                <div th:each="c : ${listaClientes}" 
                     th:if="${c.status.name() == 'PROPOSTA' || c.status.name() == 'CONDICIONADO' || c.status.name() == 'RESTRICAO'}"
                     class="card-cliente border-purple">
                    
                    <div class="d-flex justify-content-between mb-1">
                        <a th:href="@{/detalhes/{id}(id=${c.id})}" class="fw-bold card-link" th:text="${c.nome}">Nome</a>
                        <a th:href="@{/editar/{id}(id=${c.id})}" class="text-muted"><i class="bi bi-pencil-fill small"></i></a>
                    </div>
                    
                    <span class="badge-status" th:text="${c.status.descricao}">Status</span>
                    <div class="mt-2 text-muted small fst-italic" th:text="${c.nomeImovel}">Im√≥vel</div>
                </div>
            </div>
        </div>

        <div class="kanban-col">
            <div class="col-header">
                <span>CONCLU√çDO</span>
                <i class="bi bi-trophy-fill text-success"></i>
            </div>
            <div class="col-body">
                <div th:each="c : ${listaClientes}" 
                     th:if="${c.status.name() == 'APROVADO' || c.status.name() == 'ASSINATURA_CAIXA' || c.status.name() == 'ENTREGA_CHAVES' || c.status.name() == 'VENDA_FINALIZADA' || c.status.name() == 'FECHAMENTO'}"
                     class="card-cliente border-green">
                    
                    <div class="d-flex justify-content-between mb-1">
                        <a th:href="@{/detalhes/{id}(id=${c.id})}" class="fw-bold card-link" th:text="${c.nome}">Nome</a>
                        <a th:href="@{/editar/{id}(id=${c.id})}" class="text-muted"><i class="bi bi-pencil-fill small"></i></a>
                    </div>
                    
                    <span class="badge bg-success w-100" style="font-size: 0.7em;">VENDA FEITA! üí∞</span>
                    <div class="mt-2 text-dark small fw-bold" th:text="${c.nomeImovel}">Im√≥vel</div>
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>